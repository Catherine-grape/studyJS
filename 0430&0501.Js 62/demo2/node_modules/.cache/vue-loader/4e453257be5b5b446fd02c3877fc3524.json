{"remainingRequest":"/Users/fivegl/Desktop/demo2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/fivegl/Desktop/demo2/src/pages/Home/index.vue?vue&type=style&index=0&id=1faf2446&lang=less&scoped=true&","dependencies":[{"path":"/Users/fivegl/Desktop/demo2/src/pages/Home/index.vue","mtime":1619835632839},{"path":"/Users/fivegl/Desktop/demo2/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fivegl/Desktop/demo2/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/fivegl/Desktop/demo2/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/fivegl/Desktop/demo2/node_modules/less-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fivegl/Desktop/demo2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/fivegl/Desktop/demo2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmhvbWUgewogIC8vICAgYmFja2dyb3VuZDogbGlnaHRwaW5rOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTAwJTsKICAubmV3cyB7CiAgICBwYWRkaW5nLWJvdHRvbTogMTB2aDsKICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/pages/Home","sourcesContent":["<template>\n  <div class=\"home\">\n    <!-- 头部部分 -->\n    <my-header></my-header>\n\n    <!-- 轮播图部分 -->\n    <my-swiper :data=\"swiperData\"></my-swiper>\n\n    <!-- 新闻列表的部分 -->\n    <van-skeleton v-if=\"!news.length\" title :row=\"3\" />\n    <div class=\"news\">\n      <my-newsitem :key=\"index\" v-for=\"(item, index) in news\" :item=\"item\">\n      </my-newsitem>\n      <div v-show=\"flag\" style=\"height: 100px; background: lightblue\">\n        正在加载\n      </div>\n            <!-- <div v-show=\"isEnd\">已经加载完毕了</div> -->\n\n    </div>\n  </div>\n</template>\n\n<script>\nimport Header from \"../../components/header\";\nimport swiper from \"../../components/swiper\";\nimport newsItem from \"./newsitem\";\nimport { latest, before } from \"../../api/index\";\n\nimport { delay } from \"../../assets/utils\";\nexport default {\n  props: {},\n  data() {\n    return {\n      date: \"\",\n      news: [\n        /* {\n                date:'20210430',\n                list:[...]\n            } */\n      ],\n      swiperData: [],\n      flag: false,\n    };\n  },\n  created() {\n    this.getData();\n    window.addEventListener(\"scroll\", this.getMore);\n  },\n  methods: {\n    getData() {\n      latest().then((res) => {\n        console.log(res, 52);\n        let { date, stories, top_stories } = res;\n        this.date = date;\n        this.swiperData = top_stories;\n        this.news.push({ date: date, list: stories });\n      });\n    },\n    getMore() {\n      if (this.flag) {\n        return;\n      }\n      let realH = document.getElementById(\"app\").offsetHeight,\n        winH = document.documentElement.clientHeight,\n        winS = document.documentElement.scrollTop;\n      if (winH + winS + 100 >= realH) {\n        this.flag = true;\n        console.log(111);\n          this.getBefore();\n      }\n    },\n    async getBefore() {\n      /*  before(this.date).then(()=>{\n           //当前函数里的代码会等到promise的实例变成成功态以后才会执行\n       }) */\n      /* await new Promise((resolve,reject)=>{\n           setTimeout(()=>{\n               resolve();\n           },3000)\n       }) */\n      await delay();\n      let res = await before(this.date);\n      //   await下面的代码已经变成了异步的，什么时候上边的实例变成成功态，什么时候下面的代码才会执行\n      console.log(res);\n      // 每一次请求的数据都是10条，假设后台数据库一共有102条数据，咱们最多可以请求11次,如果当前请求的数据的length小于10条，那说明已经是最后一次请求了，你就可以让flag永远改为true， 让isEnd永远改为true    ,isEnd\n\n      let { date, stories} = res;\n      this.date = date; //'20210429' '20210428'\n      this.flag = false;\n      this.news.push({\n        date: date,\n        list: stories,\n      });\n\n\n/* this.isEnd=isEnd;\n      if(!isEnd){//isEnd和后台商量已经没有数据的时候作为判断 false就可以继续请求\n        this.flag = false;\n      } */\n\n      /* if (stories.length == 10) {\n        //后台如果不给字段标识的话，通过判断length\n        this.flag = false;\n      } else {\n        this.isEnd = true;\n      }\n */\n      /* let res1=await before(this.date);\n    console.log(res1); */\n    },\n  },\n  components: {\n    \"my-header\": Header,\n    \"my-swiper\": swiper,\n    \"my-newsitem\": newsItem,\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.home {\n  //   background: lightpink;\n  width: 100%;\n  height: 100%;\n  .news {\n    padding-bottom: 10vh;\n  }\n}\n</style>\n\n"]}]}